{% extends 'layouts/base.html' %}

{% block body %}
<!-- Main Content -->
<div class="body_area">
    <div class="block-header">
        <div class="container">
            <div class="row clearfix">
                <div class="col-lg-6 col-md-12">
                    <ul class="breadcrumb pl-0 pb-0 ">
                        <li class="breadcrumb-item"><a href="#">Home</a></li>
                        <li class="breadcrumb-item active">Price Predict</li>
                    </ul>
                    <h1 class="mb-1 mt-1">Comodity Price Predict - Price Predict</h1>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row clearfix">
            <div class="col-xl-8 col-lg-8 col-md-8 col-sm-8">
                <div class="card">
                    <div class="header">
                        <h2>Predict the Comodity Price - Pasar Kramat Kota Cirebon</h2>
                        <p class="mt-3" style="margin-bottom: unset;">Comodity Available to Predict: Cabai Merah Besar,
                            Cabai
                            Merah Keriting, Cabai Rawit Hijau, Cabai Rawit Merah, Bawang Merah</p>
                    </div>
                    <div class="body">
                        <p> # Ini Form Untuk Generate Prediksi</p>
                    </div>
                </div>
            </div>
            <div class="col-xl-4 col-lg-4 col-md-4 col-sm-4">
                <div class="card">
                    <div class="header">
                        <h2>Upload Dataset</h2>
                        <p class="mt-3" style="margin-bottom: unset;">
                            Dataset yang digunakan untuk melakukan prediksi harga komoditas setidaknya memiliki 30 baris
                            data, contoh template bisa di lihat <a
                                href="{{ url_for('web.download_example_dataset') }}">disini</a>.
                        </p>
                    </div>
                    <div class="body" style="margin-top: -20px;">
                        <div class="row clearfix">
                            <form id="upload_file_form" method="POST">
                                <div class="col-sm-12">
                                    <div class="form-group">
                                        <input type="file" class="form-control" name="file" id="file" />
                                    </div>
                                    <button type="submit"
                                        class="btn btn-sm btn-raised btn-primary waves-effect">Upload</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12">
                <div class="card">
                    <div class="header">
                        <h2>Comodity Price - xxxx</h2>
                    </div>
                    <div class="body">
                        <div id="apex-cabai-merah-besar"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row clearfix">
            <div class="col-md-12 col-lg-12">
                <div class="card">
                    <div class="body">
                        <p class="copyright mb-0">Copyright 2024 Â© All Rights Reserved. <a
                                href="https://hafizcaniago.my.id/" target="_blank">Hafiz Caniago</a></p>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
{% endblock %}

{% block script %}
<script src="{{ url_for('static', filename='assets/plugins/bootstrap-notify/bootstrap-notify.js') }}"></script>

<script>
    $(document).ready(function () {
        $('#upload_file_form').submit(function (e) {
            e.preventDefault();
            var form_data = new FormData($('#upload_file_form')[0]);
            $.ajax({
                type: 'POST',
                url: '/upload-xlsx',
                data: form_data,
                contentType: false,
                cache: false,
                processData: false,
                success: function (data) {
                    console.log("Success:", data);
                    $.notify({
                        message: 'File uploaded successfully!'
                    }, {
                        type: 'success',
                        delay: 2000, // Delay in milliseconds before the alert disappears
                        placement: {
                            from: "top",
                            align: "right"
                        },
                        animate: {
                            enter: 'animated fadeInDown',
                            exit: 'animated fadeOutUp'
                        }
                    });
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.log("Error response:", jqXHR.responseText);
                    var errorMessage = "Unknown error";
                    try {
                        // Attempt to parse the response as JSON
                        if (jqXHR.responseText && jqXHR.getResponseHeader('content-type').includes('application/json')) {
                            var response = JSON.parse(jqXHR.responseText);
                            if (response.error) {
                                errorMessage = response.error;
                            }
                        } else {
                            // Handle non-JSON response
                            console.log("Non-JSON response:", jqXHR.responseText);
                            errorMessage = "An unexpected error occurred. Please try again.";
                        }
                    } catch (e) {
                        console.error("Failed to parse error response:", e);
                    }
                    $.notify({
                        message: 'Error: ' + errorMessage
                    }, {
                        type: 'danger',
                        delay: 2000, // Delay in milliseconds before the alert disappears
                        placement: {
                            from: "top",
                            align: "right"
                        },
                        animate: {
                            enter: 'animated fadeInDown',
                            exit: 'animated fadeOutUp'
                        }
                    });
                }
            });
        });
    });
</script>
{% endblock %}